{% extends 'base.html' %}
{% load static %}

{% block content %}
<div id="scan_page">
<<<<<<< HEAD
	<h1>LAST SCAN</h1>

	<table class="last_scan">
		<tr>
			<th>Badge UID</th>
			<th>Login</th>
			<th>Date</th>
			<th>Event</th>
			<th>Validity</th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			{% if current_scan %}
			<td>{{ current_scan.uid }}</td>
			<td>{{ current_scan.login }}</td>
			<td>{{ current_scan.date }}</td>
			{% if current_scan.event %}
				<td>{{ current_scan.event.name }}</td>
			{% else %}
				<td> Undefined </td>
			{% endif %}
			<td> {{ current_scan.validity }} </td>
			<td align="center"><a href="{% url 'pages:update_studentbadge' current_scan.pk %}"
				class="btn btn-outline-secondary btn-sm">Update</a></td>
			<td align="center"><a href="{% url 'pages:delete_scan' current_scan.id %}"
				class="btn btn-outline-danger btn-sm">Delete</a></td>
			{% endif %}
		</tr>
		</table>
=======
>>>>>>> 76dac626e5a2e1ba879afb234dd3789c5f8b3a3a
		<h1>ALL SCANS</h1>
		<table class="scan_page_table" id="scan_table">
			<tr>
				<th>Badge UID</th>
				<th>Login</th>
				<th>Date</th>
				<th>Event</th>
				<th>Validity</th>
				<th></th>
				<th></th>
			</tr>
			{% for scan in scans reversed %}
			<tr>
				<td>{{ scan.uid }}</td>
				<td>{{ scan.login }}</td>
				<td>{{ scan.date }}</td>
				{% if scan.event %}
					<td>{{ scan.event.name }}</td>
				{% else %}
					<td> Undefined </td>
				{% endif %}
				<td> {{ scan.validity }} </td>
				<td align="center"><a href="{% url 'pages:update_studentbadge' scan.pk %}"
					class="btn btn-outline-secondary btn-sm">Update</a></td>
				<td align="center"><a href="{% url 'pages:delete_scan' scan.id %}"
					class="btn btn-outline-danger btn-sm">Delete</a></td>
		</tr>
		{% endfor %}
		
	</table>
	
</div>
<<<<<<< HEAD
<script>
	function myFunction(data) {
		document.getElementById("demo").innerHTML = JSON.stringify(data);
		} 
=======

<script>
>>>>>>> 76dac626e5a2e1ba879afb234dd3789c5f8b3a3a

	const chatSocket = new WebSocket(
		'ws://'
		+ window.location.host
		+ '/ws/log/'
	);

	chatSocket.onmessage = function(e) {
		const data = JSON.parse(e.data);
<<<<<<< HEAD
		myFunction(data);
		console.log(data);
=======
		console.log(data);
		var table = document.getElementById("scan_table");
		var row = table.insertRow(1);
		var cell = row.insertCell();
		cell.innerHTML = data.id
		var cell = row.insertCell();
		cell.innerHTML = data.login
		var cell = row.insertCell();
		cell.innerHTML = new Date(data.date).toLocaleString('en-us', {month: 'short', day: 'numeric', year: 'numeric', hour12:true,hour: 'numeric', minute: 'numeric' })
		var cell = row.insertCell();
		cell.innerHTML = data.event ? data.event : 'Undefined'
		var cell = row.insertCell();
		cell.innerHTML = data.validity
		var cell = row.insertCell();
		cell.innerHTML = '<a href="/update_studentbadge/'+ data.pk +'/" class="btn btn-outline-secondary btn-sm">Update</a>'
		var cell = row.insertCell();
		cell.innerHTML = '<a href="/delete_studentbadge/'+ data.pk +'/" class="btn btn-outline-danger btn-sm">Delete</a>'
>>>>>>> 76dac626e5a2e1ba879afb234dd3789c5f8b3a3a
	};

	chatSocket.onclose = function(e) {
		console.error('Chat socket closed unexpectedly');
	};

</script>
{% endblock %}